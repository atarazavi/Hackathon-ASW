---
phase: 01-setup
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - plugin/manifest.json
  - plugin/code.ts
  - plugin/ui.html
  - plugin/tsconfig.json
autonomous: false

must_haves:
  truths:
    - "Plugin appears in Figma Development menu"
    - "Running plugin shows UI window with title and button"
    - "TypeScript compiles without errors"
  artifacts:
    - path: "plugin/manifest.json"
      provides: "Figma plugin configuration"
      contains: "networkAccess"
    - path: "plugin/code.ts"
      provides: "Plugin sandbox logic"
      contains: "figma.showUI"
    - path: "plugin/ui.html"
      provides: "Plugin user interface"
      contains: "Design Review"
  key_links:
    - from: "plugin/manifest.json"
      to: "plugin/code.js"
      via: "main field reference"
      pattern: '"main": "code.js"'
    - from: "plugin/code.ts"
      to: "plugin/ui.html"
      via: "figma.showUI(__html__)"
      pattern: "showUI\\(__html__"

user_setup:
  - service: figma
    why: "Plugin development requires Figma Desktop app"
    env_vars: []
    dashboard_config:
      - task: "Import plugin manifest via Plugins > Development > Import plugin from manifest"
        location: "Figma Desktop > Plugins menu"
---

<objective>
Create Figma plugin boilerplate that loads in Figma and shows a UI window.

Purpose: Establish the plugin foundation so frontend developers can immediately start building data extraction in Phase 2B. Plugin must declare network access to localhost for backend communication.

Output: Working Figma plugin that appears in Development menu, opens UI window when run, ready for selection handling and API calls.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-setup/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Figma plugin files</name>
  <files>
    - plugin/manifest.json
    - plugin/code.ts
    - plugin/ui.html
    - plugin/tsconfig.json
  </files>
  <action>
Create the Figma plugin structure following patterns from 01-RESEARCH.md:

1. Create `plugin/` directory

2. Create `plugin/manifest.json`:
```json
{
  "name": "Design Review AI",
  "id": "000000000000000000",
  "api": "1.0.0",
  "main": "code.js",
  "ui": "ui.html",
  "editorType": ["figma"],
  "networkAccess": {
    "allowedDomains": ["http://localhost:8000"],
    "reasoning": "Connect to local Python backend for AI design review",
    "devAllowedDomains": ["http://localhost:*", "http://127.0.0.1:*"]
  }
}
```

Note: The `id` field uses placeholder. User will update after importing to Figma (Figma assigns real ID).

3. Create `plugin/code.ts`:
```typescript
// Design Review AI - Main plugin code (sandbox)
figma.showUI(__html__, { width: 400, height: 300 });

figma.ui.onmessage = async (msg: { type: string; data?: any }) => {
  if (msg.type === 'get-selection') {
    const selection = figma.currentPage.selection;
    if (selection.length === 0) {
      figma.ui.postMessage({ type: 'error', message: 'No frames selected. Please select one or more frames.' });
      return;
    }

    // Extract basic info from selection (Phase 2B will expand this)
    const data = selection.map(node => ({
      name: node.name,
      type: node.type,
      width: 'width' in node ? node.width : 0,
      height: 'height' in node ? node.height : 0,
    }));

    figma.ui.postMessage({ type: 'selection-data', data });
  }

  if (msg.type === 'close') {
    figma.closePlugin();
  }
};
```

4. Create `plugin/ui.html`:
```html
<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      font-family: Inter, system-ui, sans-serif;
      padding: 16px;
      margin: 0;
    }
    h3 {
      margin: 0 0 16px 0;
      font-size: 14px;
      font-weight: 600;
    }
    button {
      padding: 8px 16px;
      margin: 4px 0;
      cursor: pointer;
      background: #18A0FB;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      width: 100%;
    }
    button:hover {
      background: #0D8DE8;
    }
    #result {
      margin-top: 16px;
      padding: 12px;
      background: #F5F5F5;
      border-radius: 4px;
      font-size: 12px;
      white-space: pre-wrap;
      min-height: 100px;
    }
    .error {
      color: #F24822;
    }
  </style>
</head>
<body>
  <h3>Design Review AI</h3>
  <button id="analyze">Review Selection</button>
  <div id="result">Select frames and click "Review Selection" to analyze.</div>

  <script>
    const resultDiv = document.getElementById('result');

    document.getElementById('analyze').onclick = () => {
      resultDiv.textContent = 'Getting selection...';
      parent.postMessage({ pluginMessage: { type: 'get-selection' } }, '*');
    };

    window.onmessage = async (event) => {
      const msg = event.data.pluginMessage;
      if (!msg) return;

      if (msg.type === 'selection-data') {
        // For now, just display selection info
        // Phase 2B will add backend API call
        resultDiv.textContent = 'Selected frames:\n' + JSON.stringify(msg.data, null, 2);
      }

      if (msg.type === 'error') {
        resultDiv.innerHTML = '<span class="error">Error: ' + msg.message + '</span>';
      }
    };
  </script>
</body>
</html>
```

5. Create `plugin/tsconfig.json`:
```json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["ES2017"],
    "strict": true,
    "typeRoots": ["./node_modules/@types", "./node_modules/@figma"]
  },
  "files": ["code.ts"]
}
```
  </action>
  <verify>
1. `ls plugin/` shows: manifest.json, code.ts, ui.html, tsconfig.json
2. `cat plugin/manifest.json | grep networkAccess` - shows network config
3. TypeScript syntax valid: `npx tsc --noEmit -p plugin/tsconfig.json` (may need @figma/plugin-typings first)
  </verify>
  <done>Plugin files created with manifest declaring network access, code.ts with selection handling, ui.html with basic UI</done>
</task>

<task type="auto">
  <name>Task 2: Compile TypeScript and install Figma typings</name>
  <files>
    - plugin/code.js
    - plugin/package.json
  </files>
  <action>
Set up TypeScript compilation for the plugin:

1. Create `plugin/package.json`:
```json
{
  "name": "design-review-ai-plugin",
  "version": "1.0.0",
  "description": "Figma plugin for AI-powered design review",
  "scripts": {
    "build": "tsc",
    "watch": "tsc --watch"
  },
  "devDependencies": {
    "@figma/plugin-typings": "^1.90.0",
    "typescript": "^5.3.0"
  }
}
```

2. Install dependencies:
```bash
cd plugin && npm install
```

3. Compile TypeScript:
```bash
cd plugin && npm run build
```

This creates `plugin/code.js` that Figma will load.
  </action>
  <verify>
1. `ls plugin/code.js` exists after compilation
2. `cat plugin/code.js` shows compiled JavaScript
3. No TypeScript errors during compilation
  </verify>
  <done>TypeScript compiles to code.js, Figma typings installed, plugin ready for import</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Figma plugin boilerplate with UI window and selection detection</what-built>
  <how-to-verify>
1. Open Figma Desktop app
2. Open any design file (or create new)
3. Go to: Plugins > Development > Import plugin from manifest
4. Navigate to: `plugin/manifest.json` in this project
5. Plugin should appear in Plugins > Development > Design Review AI
6. Run the plugin - it should show UI window with:
   - Title "Design Review AI"
   - Blue "Review Selection" button
   - Gray result area
7. Select any frame and click "Review Selection"
8. Should show selection data (name, type, dimensions)
  </how-to-verify>
  <resume-signal>Type "approved" if plugin loads and shows UI, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
Phase 1 plugin requirements met:
1. Plugin manifest exists with network access declared
2. TypeScript compiles without errors
3. Plugin loads in Figma and shows UI window
4. Selection detection works (shows frame info when Review clicked)
</verification>

<success_criteria>
- [ ] plugin/ directory exists with all files (manifest.json, code.ts, code.js, ui.html, tsconfig.json, package.json)
- [ ] `npm run build` in plugin/ compiles without errors
- [ ] Plugin appears in Figma Development menu after import
- [ ] Running plugin shows "Design Review AI" window
- [ ] Clicking "Review Selection" with frames selected shows selection data
</success_criteria>

<output>
After completion, create `.planning/phases/01-setup/01-02-SUMMARY.md`
</output>
